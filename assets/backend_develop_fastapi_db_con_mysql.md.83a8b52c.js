import{_ as s,o as a,c as n,a as l}from"./app.45fb3b71.js";const p="/assets/database_products.0aa71356.png",e="/assets/can_not_found_table.39dbc3a0.png",o="data:image/png;base64,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",u=JSON.parse('{"title":"與資料庫對話(MySQL)篇","description":"","frontmatter":{},"headers":[{"level":2,"title":"環境安裝","slug":"環境安裝","link":"#環境安裝","children":[]},{"level":2,"title":"與資料庫連線(database.py)","slug":"與資料庫連線-database-py","link":"#與資料庫連線-database-py","children":[]},{"level":2,"title":"建立資料表 ( models.py )","slug":"建立資料表-models-py","link":"#建立資料表-models-py","children":[]},{"level":2,"title":"執行看看結果","slug":"執行看看結果","link":"#執行看看結果","children":[]}],"relativePath":"backend_develop/fastapi/db_con_mysql.md","lastUpdated":1683292222000}'),t={name:"backend_develop/fastapi/db_con_mysql.md"},c=l(`<h1 id="與資料庫對話-mysql-篇" tabindex="-1">與資料庫對話(MySQL)篇 <a class="header-anchor" href="#與資料庫對話-mysql-篇" aria-hidden="true">#</a></h1><p>上一篇建立是本機的資料庫，這篇來使用 <code>pymysql</code> 模組連線資料庫。</p><p>我手頭上收到一組.sql檔案，使用xampp來匯入並模擬線上phpmysql，這代表必須事先了解這資料庫的每個資料表欄位類型，才能確保連線後的動作是否正確。</p><h2 id="環境安裝" tabindex="-1">環境安裝 <a class="header-anchor" href="#環境安裝" aria-hidden="true">#</a></h2><ul><li>Sqlalchemy</li><li>Pymysql</li></ul><div class="language-cmd"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">pip install sqlalchemy pymysql</span></span>
<span class="line"></span></code></pre></div><h2 id="與資料庫連線-database-py" tabindex="-1">與資料庫連線(<a href="http://database.py" target="_blank" rel="noreferrer">database.py</a>) <a class="header-anchor" href="#與資料庫連線-database-py" aria-hidden="true">#</a></h2><p>基本上與上一篇大同小異，僅差在 <code>URL</code> 及 <code>connect_args</code> 不同。</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqlalchemy </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> create_engine</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqlalchemy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ext</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">declarative </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> declarative_base</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqlalchemy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">orm </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> sessionmaker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">DATABASE_URL </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mysql+pymysql://root@localhost:3306/我的資料庫</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">engine </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">create_engine</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    DATABASE_URL</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">connect_args</span><span style="color:#89DDFF;">={}</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">SessionLocal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sessionmaker</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">autocommit</span><span style="color:#89DDFF;">=False,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">autoflush</span><span style="color:#89DDFF;">=False,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">bind</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">Base </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">declarative_base</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>解釋一下 pymysql 連線設定 :</p><p><code>mysql + pymysql : // {帳號} : {密碼} @ {路徑} : {port} / {資料庫}</code></p><p>如果沒有密碼就不要輸入資料，就像範例一樣。</p><h2 id="建立資料表-models-py" tabindex="-1">建立資料表 ( <a href="http://models.py" target="_blank" rel="noreferrer">models.py</a> ) <a class="header-anchor" href="#建立資料表-models-py" aria-hidden="true">#</a></h2><p>承如上一開始所敘述由於是要連線到已經存在的資料庫內，所必須了解原數據類型，以免產生不必要的錯誤，以下是我收到的資料庫其中一份資料表內容。 <img src="`+p+`" alt="old_db"></p><p>先引入 <code>sqlalchemy</code> 所支援的欄位類型，可參考下方連結 :</p><ul><li><a href="https://docs.sqlalchemy.org/en/20/core/types.html" target="_blank" rel="noreferrer">Sqlalchemy 資料類型</a></li></ul><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqlalchemy </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Column</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">  Integer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> String</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> DateTime</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Text</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">Float</span></span>
<span class="line"></span></code></pre></div><p>引入上一段資料庫連線模組 <code>database.py</code>內的 <code>Base</code></p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> database </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Base</span></span>
<span class="line"></span></code></pre></div><p>開始針對資料表欄位舉出類型，可參考下方兩個連結確認支援類型。</p><ul><li><a href="https://docs.pydantic.dev/usage/types/" target="_blank" rel="noreferrer">Pydantic 資料類型</a></li></ul><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">products</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Base</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    __tablename__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">products</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Integer</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">primary_key</span><span style="color:#89DDFF;">=True,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    ppcode </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">unique</span><span style="color:#89DDFF;">=True,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">   .</span><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">    weight </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Float</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   .</span><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">    description </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Text</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    create_date </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">DateTime</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    .</span><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">    origincode </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">255</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    parent_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Integer</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   .</span><span style="color:#89DDFF;">.</span></span>
<span class="line"></span></code></pre></div><p>這串是針對與數個資料表的某個欄位相互對應所用，如果沒有可省略。</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">   items </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">relationship</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Item</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">back_populates</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">owner</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="執行看看結果" tabindex="-1">執行看看結果 <a class="header-anchor" href="#執行看看結果" aria-hidden="true">#</a></h2><p>如過無法連線，常見有問題有以下幾種 :</p><ul><li>mysql伺服器是否運作。</li><li>連線資料 (帳號、密碼、資料庫名稱) 是否正確。</li><li>資料表欄位類型、名稱是否正確。( 下圖是未找到指定的資料表 ) <img src="`+e+'" alt="can_not_found_table"></li><li>引入 <code>資料庫連線模組</code> 的 <code>路徑</code> 是否正確。</li><li>伺服器未開啟連線 : <img src="'+o+'" alt="can_not_link"></li></ul>',27),r=[c];function A(y,i,D,F,C,d){return a(),n("div",null,r)}const h=s(t,[["render",A]]);export{u as __pageData,h as default};
