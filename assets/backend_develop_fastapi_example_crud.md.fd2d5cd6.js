import{_ as a,c as e,o as s,d as l}from"./app.5a2dc0fe.js";const n="/assets/database.ef78f579.png",m=JSON.parse('{"title":"與資料庫對話 ( 範例 CRUD )","description":"","frontmatter":{},"headers":[{"level":2,"title":"環境安裝","slug":"環境安裝","link":"#環境安裝","children":[]},{"level":2,"title":"創建需要文件說明","slug":"創建需要文件說明","link":"#創建需要文件說明","children":[]},{"level":2,"title":"Read 讀取 ( get )","slug":"read-讀取-get","link":"#read-讀取-get","children":[{"level":3,"title":"共用核對欄位 ( schema.py )","slug":"共用核對欄位-schema-py","link":"#共用核對欄位-schema-py","children":[]},{"level":3,"title":"方法建立 ( crud.py )","slug":"方法建立-crud-py","link":"#方法建立-crud-py","children":[]},{"level":3,"title":"引入所有處理資料的檔案 ( main.py )","slug":"引入所有處理資料的檔案-main-py","link":"#引入所有處理資料的檔案-main-py","children":[]}]},{"level":2,"title":"Create 創建","slug":"create-創建","link":"#create-創建","children":[]},{"level":2,"title":"Update 更新","slug":"update-更新","link":"#update-更新","children":[]},{"level":2,"title":"Delete 刪除","slug":"delete-刪除","link":"#delete-刪除","children":[{"level":3,"title":"參考","slug":"參考","link":"#參考","children":[]}]}],"relativePath":"backend_develop/fastapi/example_crud.md","lastUpdated":null}'),t={name:"backend_develop/fastapi/example_crud.md"},p=l('<h1 id="與資料庫對話-範例-crud" tabindex="-1">與資料庫對話 ( 範例 CRUD ) <a class="header-anchor" href="#與資料庫對話-範例-crud" aria-hidden="true">#</a></h1><p>延續幾篇內容，以連接 mysql 直接製作常見的範例CRUD。</p><h2 id="環境安裝" tabindex="-1">環境安裝 <a class="header-anchor" href="#環境安裝" aria-hidden="true">#</a></h2><ul><li>venv</li><li>FastAPI、Uvicorn、Sqlalchemy</li><li>pymysql 或其他連接sql的模組</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>如果是sqlite db不需要安裝其他模組</p></div><h2 id="創建需要文件說明" tabindex="-1">創建需要文件說明 <a class="header-anchor" href="#創建需要文件說明" aria-hidden="true">#</a></h2><p>前幾篇文中都一直在提到下方這兩個檔案內容周旋。</p><ul><li><code>database.py</code> 連結資料庫的設定檔(帳號、密碼、資料庫名)。</li><li><code>model.py</code> 資料表模組 ( 資料表名<code>__tablename__</code>、欄位<code>Column</code>、類型<code>type</code>、關聯性<code>relationship</code> )。</li></ul><p>這段開始則以另外這兩份表作為闡述。</p><ul><li><code>schema.py</code> 用來查核或檢測輸入類別與資料表是否對應。</li><li><code>crud.py</code> 處理資料表(例如:取得資料表、篩選、創建資料表等方法)。</li></ul><p>最後使用<code>post</code>、<code>get</code>、<code>put</code>、<code>delete</code>路由導入到<code>main.py</code>中，就像下方的關聯圖一樣，最終紅色箭頭的指向。 <img src="'+n+`" alt="er_diagram"></p><h2 id="read-讀取-get" tabindex="-1">Read 讀取 ( get ) <a class="header-anchor" href="#read-讀取-get" aria-hidden="true">#</a></h2><p>先從讀取資料開始，順便測試能否連上資料表。</p><h3 id="共用核對欄位-schema-py" tabindex="-1">共用核對欄位 ( <a href="http://schema.py" target="_blank" rel="noreferrer">schema.py</a> ) <a class="header-anchor" href="#共用核對欄位-schema-py" aria-hidden="true">#</a></h3><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># schema.py</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="方法建立-crud-py" tabindex="-1">方法建立 ( <a href="http://crud.py" target="_blank" rel="noreferrer">crud.py</a> ) <a class="header-anchor" href="#方法建立-crud-py" aria-hidden="true">#</a></h3><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># crud.py</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="引入所有處理資料的檔案-main-py" tabindex="-1">引入所有處理資料的檔案 ( <a href="http://main.py" target="_blank" rel="noreferrer">main.py</a> ) <a class="header-anchor" href="#引入所有處理資料的檔案-main-py" aria-hidden="true">#</a></h3><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># main.py</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> crud</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> models</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> schema</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> database </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> SessionLocal</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> engine</span></span>
<span class="line"></span></code></pre></div><p>開啟資料庫</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># main.py</span></span>
<span class="line"><span style="color:#A6ACCD;">models</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Base</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create_all</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">bind</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>宣告一下依賴的資料庫，並確保取得資料後即關閉，避免資源消耗。</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># main.py</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_db</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SessionLocal</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">yield</span><span style="color:#A6ACCD;"> db</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">finally</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><h2 id="create-創建" tabindex="-1">Create 創建 <a class="header-anchor" href="#create-創建" aria-hidden="true">#</a></h2><p>隨後補上...</p><h2 id="update-更新" tabindex="-1">Update 更新 <a class="header-anchor" href="#update-更新" aria-hidden="true">#</a></h2><p>隨後補上...</p><h2 id="delete-刪除" tabindex="-1">Delete 刪除 <a class="header-anchor" href="#delete-刪除" aria-hidden="true">#</a></h2><p>隨後補上...</p><hr><h3 id="參考" tabindex="-1">參考 <a class="header-anchor" href="#參考" aria-hidden="true">#</a></h3><ul><li><a href="https://ahmed-nafies.medium.com/tutorial-fastapi-with-sqlalchemy-async-orm-and-alembic-2fa68102f82d" target="_blank" rel="noreferrer">FastAPI with SQLAlchemy Async ORM and Alembic</a></li><li><a href="https://codevoweb.com/crud-restful-api-server-with-python-fastapi-and-mongodb/" target="_blank" rel="noreferrer">CRUD RESTful API Server with Python, FastAPI, and MongoDB</a></li><li><a href="https://codevoweb.com/crud-restful-api-server-with-python-fastapi-and-postgresql/" target="_blank" rel="noreferrer">CRUD RESTful API Server with Python, FastAPI, and PostgreSQL</a></li></ul>`,32),o=[p];function c(r,i,d,y,h,u){return s(),e("div",null,o)}const F=a(t,[["render",c]]);export{m as __pageData,F as default};
