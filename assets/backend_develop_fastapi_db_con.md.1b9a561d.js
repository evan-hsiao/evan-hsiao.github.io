import{_ as s,o as a,c as n,a as l}from"./app.ab2e6989.js";const C=JSON.parse('{"title":"與資料庫對話(.env)篇","description":"","frontmatter":{},"headers":[{"level":2,"title":"環境設置","slug":"環境設置","link":"#環境設置","children":[]},{"level":2,"title":"建立 .env 檔","slug":"建立-env-檔","link":"#建立-env-檔","children":[]},{"level":2,"title":"引入 dotenv","slug":"引入-dotenv","link":"#引入-dotenv","children":[{"level":3,"title":"參考","slug":"參考","link":"#參考","children":[]}]}],"relativePath":"backend_develop/fastapi/db_con.md","lastUpdated":1683292222000}'),o={name:"backend_develop/fastapi/db_con.md"},p=l(`<h1 id="與資料庫對話-env-篇" tabindex="-1">與資料庫對話(.env)篇 <a class="header-anchor" href="#與資料庫對話-env-篇" aria-hidden="true">#</a></h1><p>與數據庫對話要避免建立環境時敏感資料外流，常會使用到.env設定。這裡使用到pytho-dotenv。</p><h2 id="環境設置" tabindex="-1">環境設置 <a class="header-anchor" href="#環境設置" aria-hidden="true">#</a></h2><ul><li>venv</li><li>python</li><li>python-dotenv</li></ul><div class="language-cmd"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">pip install python</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">dotenv</span></span>
<span class="line"></span></code></pre></div><h2 id="建立-env-檔" tabindex="-1">建立 .env 檔 <a class="header-anchor" href="#建立-env-檔" aria-hidden="true">#</a></h2><p>當然一開始就須先建立.env檔案，內容可以自己填。以下是範例。</p><div class="language-cmd"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">DATABASE_URL </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mysql+pymysql://root@localhost:3306/資料庫</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>或者是以下這樣:</p><div class="language-cmd"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">DB_USER</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">root</span></span>
<span class="line"><span style="color:#A6ACCD;">DB_PASSWORD</span><span style="color:#89DDFF;">=</span><span style="color:#676E95;font-style:italic;">&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">DB_HOST</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">localhost</span></span>
<span class="line"><span style="color:#A6ACCD;">DB_PORT</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span></span>
<span class="line"><span style="color:#A6ACCD;">DB_NAME</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">資料庫</span></span>
<span class="line"></span></code></pre></div><h2 id="引入-dotenv" tabindex="-1">引入 dotenv <a class="header-anchor" href="#引入-dotenv" aria-hidden="true">#</a></h2><ul><li><code>os</code>模塊是用來調用系統命令，用在刪除、使用、查詢等等。</li><li><code>pathlib</code>模塊是用來調用文件路徑。</li></ul><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> dotenv </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> load_dotenv</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> pathlib </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> Path</span></span>
<span class="line"></span></code></pre></div><p>指定<code>.env</code>檔案路徑</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">env_path</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">Path</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.env</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#82AAFF;">load_dotenv</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">dotenv_path</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">env_path</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>使用方式要配合 <code>os.getenv()</code> 這個指令。</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">engine</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">create_engine</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DATABASE_URL</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">echo</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"></span></code></pre></div><p>或改成這樣</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">dbuser</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DB_USER</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">dbpwd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DB_PASSWORD</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">dbhost</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DB_HOST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">dbport</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DB_PORT</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">dbname</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getenv</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DB_NAME</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">dburl</span><span style="color:#89DDFF;">=</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;mysql+pymysql://</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">dbuser</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">dbpwd</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">@</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">dbhost</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">dbport</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">dbname</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">engine</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">create_engine</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">dburl</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">echo</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"></span></code></pre></div><hr><h3 id="參考" tabindex="-1">參考 <a class="header-anchor" href="#參考" aria-hidden="true">#</a></h3><ul><li><a href="https://myapollo.com.tw/blog/python-dotenv/" target="_blank" rel="noreferrer">Python dotenv 介紹與使用教學</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10225075" target="_blank" rel="noreferrer">DAY 19 : python .env 使用</a></li><li><a href="https://learningsky.io/python-use-environmental-variables-to-hide-sensitive-information/" target="_blank" rel="noreferrer">利用 .env 與環境變數隱藏敏感資訊</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10185280" target="_blank" rel="noreferrer">Day7 Python 基礎 - 認識模塊</a></li></ul>`,22),e=[p];function t(c,r,D,y,i,F){return a(),n("div",null,e)}const A=s(o,[["render",t]]);export{C as __pageData,A as default};
